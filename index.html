<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Editor Gambar - DSRT</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #previewImage {
      transition: all 0.3s ease;
      max-height: 400px;
      max-width: 100%;
    }
    #cropBox {
      position: absolute;
      border: 2px dashed #22d3ee;
      display: none;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col md:flex-row">

  <!-- Sidebar (desktop) -->
  <aside class="hidden md:flex md:w-64 bg-gray-800 p-4 flex-col gap-4">
    <h1 class="text-xl font-bold text-cyan-400">Tools</h1>
    <nav class="flex flex-col gap-2">
      <button data-tool="crop" class="tool-btn py-2 px-4 bg-gray-700 rounded hover:bg-cyan-600">Crop</button>
      <button data-tool="rotate" class="tool-btn py-2 px-4 bg-gray-700 rounded hover:bg-cyan-600">Rotate</button>
      <button data-tool="adjust" class="tool-btn py-2 px-4 bg-gray-700 rounded hover:bg-cyan-600">Adjust</button>
      <button data-tool="filter" class="tool-btn py-2 px-4 bg-gray-700 rounded hover:bg-cyan-600">Filter</button>
    </nav>
    <button id="downloadBtnDesktop" class="mt-4 py-2 px-4 bg-cyan-600 rounded hover:bg-cyan-500">Download</button>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-4 flex flex-col gap-4 pb-20 md:pb-4">
    <!-- Upload -->
    <div>
      <label class="block mb-2 text-sm font-medium text-gray-300">Upload Gambar</label>
      <input id="fileInput" type="file" accept="image/*"
        class="block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 
               file:rounded-lg file:border-0 file:text-sm file:font-semibold 
               file:bg-cyan-600 file:text-white hover:file:bg-cyan-500"/>
    </div>

    <!-- Preview -->
    <div class="bg-gray-700 rounded-xl flex items-center justify-center p-2 relative">
      <img id="previewImage" src="https://via.placeholder.com/500" alt="Preview" class="rounded shadow-lg">
      <div id="cropBox"></div>
    </div>

    <!-- Panel Tools -->
    <div id="toolPanel" class="bg-gray-800 p-4 rounded-xl shadow-lg hidden"></div>
  </main>

  <!-- Toolbar bawah (mobile) -->
  <div class="fixed bottom-0 left-0 right-0 bg-gray-800 p-2 flex justify-around md:hidden">
    <button data-tool="crop" class="tool-btn flex flex-col items-center text-sm">
      ‚úÇÔ∏è<span>Crop</span>
    </button>
    <button data-tool="rotate" class="tool-btn flex flex-col items-center text-sm">
      üîÑ<span>Rotate</span>
    </button>
    <button data-tool="adjust" class="tool-btn flex flex-col items-center text-sm">
      üéöÔ∏è<span>Adjust</span>
    </button>
    <button data-tool="filter" class="tool-btn flex flex-col items-center text-sm">
      üé®<span>Filter</span>
    </button>
    <button id="downloadBtnMobile" class="flex flex-col items-center text-sm">
      ‚¨áÔ∏è<span>Save</span>
    </button>
  </div>

  <canvas id="canvas" class="hidden"></canvas>

  <script>
    const img = document.getElementById('previewImage');
    const fileInput = document.getElementById('fileInput');
    const toolPanel = document.getElementById('toolPanel');
    const toolButtons = document.querySelectorAll('.tool-btn');
    const downloadBtnDesktop = document.getElementById('downloadBtnDesktop');
    const downloadBtnMobile = document.getElementById('downloadBtnMobile');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const cropBox = document.getElementById('cropBox');

    let rotation = 0, brightness = 100, contrast = 100;
    let activeFilter = "";
    let cropActive = false;
    let startX, startY, endX, endY;

    function updateImageStyle() {
      img.style.transform = `rotate(${rotation}deg)`;
      img.style.filter = `${activeFilter} brightness(${brightness}%) contrast(${contrast}%)`;
    }

    // Upload gambar
    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => { img.src = e.target.result; };
        reader.readAsDataURL(file);
      }
    });

    // Tool panel
    toolButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const tool = btn.dataset.tool;
        let content = "";

        if (tool === 'crop') {
          cropActive = true;
          content = `<h2 class="text-lg font-semibold text-cyan-400">Crop</h2>
                     <p class="text-gray-300">Tarik area di atas gambar, lalu klik "Apply Crop".</p>
                     <button id="applyCrop" class="mt-2 px-3 py-1 bg-cyan-600 rounded hover:bg-cyan-500">Apply Crop</button>`;
        }
        if (tool === 'rotate') {
          content = `<h2 class="text-lg font-semibold text-cyan-400">Rotate</h2>
                     <input id="rotateRange" type="range" min="0" max="360" value="${rotation}" class="w-full">`;
        }
        if (tool === 'adjust') {
          content = `<h2 class="text-lg font-semibold text-cyan-400">Adjust</h2>
                     <label class="block mt-2">Brightness</label>
                     <input id="brightRange" type="range" min="50" max="200" value="${brightness}" class="w-full">
                     <label class="block mt-2">Contrast</label>
                     <input id="contrastRange" type="range" min="50" max="200" value="${contrast}" class="w-full">`;
        }
        if (tool === 'filter') {
          content = `<h2 class="text-lg font-semibold text-cyan-400">Filter</h2>
                     <div class="flex gap-2 mt-2 flex-wrap">
                       <button class="filter-btn px-3 py-1 bg-gray-700 rounded hover:bg-cyan-500" data-filter="grayscale(100%)">Grayscale</button>
                       <button class="filter-btn px-3 py-1 bg-gray-700 rounded hover:bg-cyan-500" data-filter="sepia(100%)">Sepia</button>
                       <button class="filter-btn px-3 py-1 bg-gray-700 rounded hover:bg-cyan-500" data-filter="invert(100%)">Invert</button>
                       <button class="filter-btn px-3 py-1 bg-gray-700 rounded hover:bg-cyan-500" data-filter="">Reset</button>
                     </div>`;
        }

        toolPanel.innerHTML = content;
        toolPanel.classList.remove('hidden');

        const rotateRange = document.getElementById('rotateRange');
        if (rotateRange) rotateRange.addEventListener('input', e => { rotation = e.target.value; updateImageStyle(); });

        const brightRange = document.getElementById('brightRange');
        if (brightRange) brightRange.addEventListener('input', e => { brightness = e.target.value; updateImageStyle(); });

        const contrastRange = document.getElementById('contrastRange');
        if (contrastRange) contrastRange.addEventListener('input', e => { contrast = e.target.value; updateImageStyle(); });

        const filterBtns = document.querySelectorAll('.filter-btn');
        filterBtns.forEach(fb => fb.addEventListener('click', () => { activeFilter = fb.dataset.filter; updateImageStyle(); }));

        const applyCrop = document.getElementById('applyCrop');
        if (applyCrop) applyCrop.addEventListener('click', () => {
          if (!startX || !endX) return;
          const rect = img.getBoundingClientRect();
          const sx = startX - rect.left;
          const sy = startY - rect.top;
          const sw = endX - startX;
          const sh = endY - startY;

          const tempCanvas = document.createElement('canvas');
          const tctx = tempCanvas.getContext('2d');
          tempCanvas.width = sw;
          tempCanvas.height = sh;
          tctx.drawImage(img, sx, sy, sw, sh, 0, 0, sw, sh);
          img.src = tempCanvas.toDataURL();
          cropBox.style.display = "none";
          cropActive = false;
        });
      });
    });

    // Crop box
    img.parentElement.addEventListener('mousedown', e => {
      if (!cropActive) return;
      const rect = img.getBoundingClientRect();
      startX = e.clientX;
      startY = e.clientY;
      cropBox.style.left = `${startX - rect.left}px`;
      cropBox.style.top = `${startY - rect.top}px`;
      cropBox.style.width = "0px";
      cropBox.style.height = "0px";
      cropBox.style.display = "block";
      img.parentElement.addEventListener('mousemove', resizeCrop);
    });
    document.addEventListener('mouseup', () => { img.parentElement.removeEventListener('mousemove', resizeCrop); });
    function resizeCrop(e) {
      const rect = img.getBoundingClientRect();
      endX = e.clientX;
      endY = e.clientY;
      cropBox.style.width = `${endX - startX}px`;
      cropBox.style.height = `${endY - startY}px`;
    }

    // Download
    function downloadImage() {
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;
      ctx.filter = `${activeFilter} brightness(${brightness}%) contrast(${contrast}%)`;
      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.rotate(rotation * Math.PI / 180);
      ctx.drawImage(img, -img.naturalWidth / 2, -img.naturalHeight / 2);
      ctx.restore();
      const link = document.createElement('a');
      link.download = 'edited-image.png';
      link.href = canvas.toDataURL();
      link.click();
    }
    downloadBtnDesktop?.addEventListener('click', downloadImage);
    downloadBtnMobile?.addEventListener('click', downloadImage);
  </script>
</body>
</html>
